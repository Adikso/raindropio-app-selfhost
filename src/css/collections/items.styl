@require "../consts.styl";

sidebarRightGap = 17px;
collectionPaddingVertical = 6px;
groupHeight = 24px;

collectionActive() {
	//transition: background .1s ease-in-out;
    background: colorTheme;
    background: var(--accentColor);
    color: white;
    
    .collectionIcon.svgIcon, .count, .expand, .actions span {
    	opacity:1;
    }
    
    img.collectionIcon {
    	//filter: url(#filter_border_white);
    	//filter: drop-shadow(1px 0px 1px rgba(0,0,0,.05)) drop-shadow(0px 1px 1px rgba(0,0,0,.05)) drop-shadow(-1px 0px 1px rgba(0,0,0,.05));
    }
    
    .collectionIcon.svgIcon {
    	//transition-delay: .15s;
    }
    
    &:after {
        display: none;
    }
    
    .domain, p, .tags a {
        color: rgba(255,255,255,.7);
    }

	.status {
		opacity:1 
	}

	&.found .title {
		color: black !important;
	}
    
    ::-webkit-input-placeholder {
        color: rgba(255,255,255,.7);
    }
    :-moz-placeholder {
	    color: rgba(255,255,255,.7);
	}
	::-moz-placeholder {
	    color: rgba(255,255,255,.7);
	}
	:-ms-input-placeholder {
	    color: rgba(255,255,255,.7);
	}
}

groupActive(){
    background: colorTheme;
    color: white;

    input[type='text'],.toggle {
    	color: inherit;
    	opacity:1;
    }
}

img.collectionIcon {
	width: 20px
	height:20px
	object-fit: cover;
}

.collections {
	overflow: overlay !important
}

.collection {
	display: flex;
	align-items: center;
	position: relative;
	padding: collectionPaddingVertical 0px;
	padding-right: (sidebarRightGap - 8px);
	//transition: background .01s linear, color .01s linear;
	padding-left: calc(var(--level) * 21px);

	.expand {		
		opacity: .4;
		color: inherit;
		position:relative;
		z-index:1;
		outline: none;
		box-sizing: initial;
		padding: collectionPaddingVertical 0px;
		margin: (collectionPaddingVertical * -1) 0px;

		* {
			pointer-events: none;
		}

		.svgIcon {
			vertical-align: -3px;
		}
	}
	
	.expand {visibility: hidden;}
	
	.collectionIcon {
		margin-right: 10px
		&.svgIcon {
			opacity: .5;
			//transition: opacity .15s ease-in-out;
		}
		
		&.accent {
			&.svgIcon {
				opacity: 1;
				color: colorTheme;
			}
		}
	}
	
	.title {
		@extend .text-overflow;
		min-width:0;
		font-size: 14px
	}

	.space {
		flex: 1;
	}
	
	input[type='text'] {
		color: currentColor;
		flex: 1;
		min-width: 0;
		font-size: 14px
		background: transparent;
		appearance: none;
		padding:0;margin:0;border:0;box-shadow:none;
		
		&:focus {
			padding: 2px;
			border-radius: 2px;
			box-shadow: 0 0 0 2px rgba(colorTheme, .5);
			animation: inputFocusAnimation .15s ease-in-out;
		}
	}

	input[type='checkbox'] {
		margin-right: 8px
	}
	
	.count {
		@extend .text-overflow;
		opacity: .6;
		font-size: 11px
		padding: 0px 6px;
		text-align:right;
		margin-top: -1px;
	}

	.status {
		opacity: .4
		height: 20px
		margin-left: 3px
	}

	.count, .actions {
		width: 42px;
		min-width: 42px;
	}

	.actions {
		display: none;
		text-align: right;
		justify-content: flex-end;

		span {
			opacity: .7;
			position:relative;
			z-index:1;
			display: block;
			padding: 0 4px
		}
	}

	.permalink {
        outline: none;
        position: absolute;
        left:0;right: 0;bottom:0;top:0;
    }

    &.expanded .expand, &.collapsed .expand {
    	visibility: visible;
    }

    &.collapsed .expand .svgIcon {
    	transform: rotate(-90deg);
    }

    

    &:hover {
    	background-color: rgba(0,0,0,0.07);
    }

    //[data-is-focus="true"]:not(.active), 
    &.active {
        background: rgba(0,0,0,0.08);
    }

    &.is-dragging {
    	box-shadow: 0 1px 3px rgba(0,0,0,.1)
    }
    
    &.is-drag-over {
    	transition: box-shadow .15s ease-in-out, background .15s ease-in-out;
    	background-color: rgba(74,116,226,.1) !important;
    	box-shadow: inset 0px 0px 0px 2px rgba(74,116,226,.5);
    }
    
    &.no-focus {
    	.title {
    		opacity: .6;
    	}
    }
    
    &.placeholder {
		&:before {
			background: currentColor;
			height: 2px;
			margin: 10px 0px;
			margin-left: 20px;
			content: "";
			opacity: .07;
			width: 80%;
		}
		
		&.small:before {
			width: 30%;
		}
	}

	&.found {
		.title {
			background: var(--foundbg, colorYellowLight);
			box-shadow: 1px 0 0 2px var(--foundbg, colorYellowLight), -1px 0 0 2px var(--foundbg, colorYellowLight);
			border-radius: 1px
		}

		&.found-active {
			--foundbg: colorOrangeLight;
		}
	}
}

html:not(.clipper) .collection {
	&.active:not([data-is-focus="true"]) {
    	background: rgba(0,0,0,0.08) !important;
    }
}

html.clipper .collection.active {
	collectionActive()
}

html:not(.blur) .collection.active {
    &[data-is-focus="true"] {
        collectionActive()
    }
}

html.web:not(.electron) .collection {
	.expand, .actions span {
		&:hover {
			opacity:1;
		}

		&:active {
			opacity:.3;
		}
	}
	
	&.have-actions:hover {
    	.count {
    		display: none;
    	}
    	.actions {
    		display: flex;
    	}
    }
}

div:active > section .collection.active:not(:active) {
	background: transparent !important;
}

section:first-child .group {
	margin-top:0;
}

.group {
	cursor: default;
	padding-top: 6px
	padding-bottom: 2px
	padding-left: 20px;
	font-size: 13px
	color: #767676;
	display: flex;
	align-items: center;
	
	&.placeholder {
		&:before {
			//background: currentColor;
			height: 2px;
			margin: 9px 0px;
			width: 30%;
			content: "";
			opacity: .1;
		}
	}
	
	.title {
		@extend .text-overflow;
		flex: 1;
		min-width:0;
		height: groupHeight
		line-height: groupHeight
		padding-right: 16px;
	}
	
	form {
		width: 100%;
		flex: 1;
		display:flex;
	}
	
	input[type='text'] {
		width: 100%;
		display: block;
		height: groupHeight
		line-height: groupHeight
		background: transparent;
		box-shadow: none;border:0;
		appearance: none;
		margin:0;padding:0;
		padding-bottom: 1px;
		font-size: 13px
		flex:1;
		margin-right: 16px;
	}

	.toggle {
		height: groupHeight
    	line-height: groupHeight
		padding:0 4px;
		padding-right: (sidebarRightGap - 4px)
		display:none;
		color: black;
		opacity: .55;

		&:active {
			opacity: .7;
		}
	}
	
	&.active {
        groupActive()
    }
    
    &.is-dragging {
    	box-shadow: 0 1px 3px rgba(0,0,0,.1)
    }
    
    &.is-drag-over {
    	transition: box-shadow .15s ease-in-out, background .15s ease-in-out;
    	background-color: rgba(74,116,226,.1) !important;
    	box-shadow: inset 0px 0px 0px 2px rgba(74,116,226,.5);
    }
	
	&:hover {
		background-color: rgba(0,0,0,0.07);
		.toggle {
			display:block;
		}
	}
}


html.mac.web {
	.collection {
		.title, input[type='text'] {
			font-size: 13.5px
		}
	}
	
	.group, .group input[type='text'] {
		font-size: 12.5px
	}
}


.collectionPathWrap {
	flex:1;
	display: flex;
	flex-direction: column;

	.pathWrap {
		flex:1;
		overflow: hidden;
		overflow-y: scroll;
		overflow-y: overlay;
		display: none;
	}
	
	&[data-focus="true"] .pathWrap {
		display: block;
	}
}

.pathWrap {
	padding: 1px 0;
	margin: 0 16px;
	margin-bottom: 16px;
	border-radius: 2px;
	box-shadow: 0px 0px 0px 1px rgba(0,0,0,.1);
	background: sidebarBackground;
	
	.expand {
		visibility: hidden !important;
	}
	
	.collection.active {
		color: white;
		background: colorTheme !important;
	}
}

.picker-search-input {
	padding: 12px 16px
	padding-top: 0
}

.collections-select-mode {
	position: absolute
	z-index: 3
	top: 1px
	left: 7px
	right: 7px
	background: white
	box-shadow: 0 0 0 1px rgba(0,0,0,.15), 0 3px 15px rgba(0,0,0,.1)
	border-radius: 4px

	.collections-select-mode-header {
		display: flex
		align-items: center
		padding: 10px 12px

		.title {
			flex: 1
            font-weight: 500
            font-size: 14px
            @extend .text-overflow
		}
	}

	.collections-select-mode-actions {
		margin-top: -10px
		display: flex
		align-items: center
		padding: 0 4px
	}
}

html:not(.blur) .collection-new-form {
	collectionActive()
	
	.collectionIcon {
		opacity: 1 !important;
	}
	
	::-webkit-input-placeholder {
		color: rgba(255,255,255,.6)
	}
}

.theme-sidebar-dark {
	.collection.found .title {
		color: black
	}
}